<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–ü–µ—á–∞—Ç—å –∑–∞–∫–∞–∑–æ–≤</title>
<style>
  /* –±–∞–∑–æ–≤—ã–π —Å—Ç–∏–ª—å –¥–ª—è –ø–µ—á–∞—Ç–∏ */
  @media print {
    body * { visibility: hidden; }
    #printable, #printable * { visibility: visible; }
    #printable { position: absolute; top: 0; left: 0; }
  }
</style>
</head>
<body>

<h2>–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω –∏ –∑–∞–∫–∞–∑</h2>

<select id="templateSelect">
  <option value="acceptance">–ö–≤–∏—Ç–∞–Ω—Ü–∏—è –ø—Ä–∏–µ–º–∫–∏</option>
  <option value="act">–ê–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç</option>
</select>

<input type="text" id="orderNumber" placeholder="–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞" />

<button onclick="renderPrint()">–ü–æ–∫–∞–∑–∞—Ç—å –¥–ª—è –ø–µ—á–∞—Ç–∏</button>
<button onclick="window.print()">–ü–µ—á–∞—Ç—å</button>

<div id="printable" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px; display:none;">
  <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–µ—á–∞—Ç–∏ -->
</div>

<script>
const templates = {
  acceptance: (order) => `
    <h3>–ö–≤–∏—Ç–∞–Ω—Ü–∏—è –ø—Ä–∏–µ–º–∫–∏ –∑–∞–∫–∞–∑–∞ ‚Ññ${order.number}</h3>
    <p>–ö–ª–∏–µ–Ω—Ç: ${order.client}</p>
    <p>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${order.device}</p>
    <p>–î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞: ${order.date}</p>
    <p>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è: ${order.notes}</p>
  `,
  act: (order) => `
    <h3>–ê–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç –ø–æ –∑–∞–∫–∞–∑—É ‚Ññ${order.number}</h3>
    <p>–ö–ª–∏–µ–Ω—Ç: ${order.client}</p>
    <p>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${order.device}</p>
    <p>–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${order.done}</p>
    <p>–î–∞—Ç–∞ —Å–¥–∞—á–∏: ${order.date}</p>
  `
};

// üîê –í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å–≤–æ–π API-–∫–ª—é—á
const AIRTABLE_API_KEY = '–í–°–¢–ê–í–¨_–°–Æ–î–ê_–°–í–û–ô_API_–ö–õ–Æ–ß';

// üÜî –í—Å—Ç–∞–≤—å —Å—é–¥–∞ ID —Å–≤–æ–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
const BASE_ID = '–í–°–¢–ê–í–¨_–°–Æ–î–ê_ID_–ë–ê–ó–´';

// üìÑ –í—Å—Ç–∞–≤—å —Å—é–¥–∞ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã
const TABLE_NAME = '–í–°–¢–ê–í–¨_–°–Æ–î–ê_–ò–ú–Ø_–¢–ê–ë–õ–ò–¶–´';

async function getOrderData(number) {
  const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(TABLE_NAME)}?filterByFormula=${encodeURIComponent(`{–ù–æ–º–µ—Ä}='${number}'`)}`;

  const response = await fetch(url, {
    headers: {
      Authorization: `Bearer ${AIRTABLE_API_KEY}`
    }
  });

  const data = await response.json();

  if (data.records.length === 0) {
    alert('–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω');
    return null;
  }

  const record = data.records[0].fields;

  return {
    number: record['–ù–æ–º–µ—Ä'] || '',
    client: record['–ö–ª–∏–µ–Ω—Ç'] || '',
    device: record['–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ'] || '',
    date: record['–î–∞—Ç–∞'] || '',
    notes: record['–ü—Ä–∏–º–µ—á–∞–Ω–∏—è'] || '',
    done: record['–í—ã–ø–æ–ª–Ω–µ–Ω–æ'] || ''
  };
}

async function renderPrint() {
  const tpl = document.getElementById('templateSelect').value;
  const number = document.getElementById('orderNumber').value.trim();

  if (!number) {
    alert('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞');
    return;
  }

  const order = await getOrderData(number);

  if (!order) return;

  const html = templates[tpl](order);
  const printDiv = document.getElementById('printable');
  printDiv.innerHTML = html;
  printDiv.style.display = 'block';
}
</script>

</body>
</html>
